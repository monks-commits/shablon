<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Афіша — Ваш Адмін</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>

  <!-- Шапка -->
  <div id="site-header"></div>
  <script type="module" src="/scripts/include.js"></script>

  <main class="main">

    <!-- Заголовок страницы -->
    <section class="page-header">
      <div class="container page-header__inner">
        <h1 class="page-title">Афіша</h1>
        <p class="page-subtitle">
          Оберіть виставу та забронюйте квитки онлайн за ціною каси театру.
        </p>
      </div>
    </section>

    <!-- Фильтры и сетка афиши -->
    <section class="section">
      <div class="container">

        <!-- Фильтры по місту -->
        <div class="filters">
          <button class="pill pill--active" data-city="all">Всі міста</button>
          <button class="pill" data-city="Дніпро">Дніпро</button>
          <button class="pill" data-city="Кривий Ріг">Кривий Ріг</button>
        </div>

        <!-- Сетка спектаклей -->
        <div id="grid" class="grid-events"></div>

        <!-- Сообщение "пусто" -->
        <p id="empty" class="meta meta--empty" style="display:none">
          Подій за вибраним фільтром поки немає.
        </p>

      </div>
    </section>

  </main>

  <!-- Подвал -->
  <div id="site-footer"></div>

  <script>
  (async () => {
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const pills = document.querySelectorAll('.pill');

    // Загружаем афишу
    let items = [];
    try {
      const res = await fetch('/data/afisha.json', { cache: 'no-store' });
      items = res.ok ? await res.json() : [];
    } catch (e) {
      items = [];
    }

    function cardHTML(s) {
      const poster = s.poster ? '/' + s.poster.replace(/^\/+/, '') : '';
      const show = encodeURIComponent(s.show);
      const dateTime = [s.date, s.time].filter(Boolean).join(' • ');
      const place = [s.theatre, s.stage].filter(Boolean).join(' • ');
      const city = s.city || '';

      return `
        <article class="card event-card">
          ${poster ? `<img class="event-card__poster" src="${poster}" alt="${s.title || ''}" onerror="this.style.display='none'">` : ''}
          <div class="event-card__body">
            <h2 class="event-card__title">${s.title || ''}</h2>
            ${dateTime ? `<p class="meta event-card__meta">${dateTime}</p>` : ''}
            ${place ? `<p class="meta event-card__meta">${place}</p>` : ''}
            ${city ? `<p class="meta event-card__meta">${city}</p>` : ''}
            <div class="event-card__actions">
              <a class="btn btn--secondary" href="/show.html?show=${show}">Детальніше</a>
              <a class="btn btn--primary" href="/spectacles/hall.html?show=${show}">Вибрати місця</a>
            </div>
          </div>
        </article>
      `;
    }

    function render(city = 'all') {
      const data = city === 'all'
        ? items
        : items.filter(x => (x.city || '').toLowerCase() === city.toLowerCase());

      grid.innerHTML = data.map(cardHTML).join('');
      empty.style.display = data.length ? 'none' : 'block';
    }

    // Переключение фильтров
    pills.forEach(p => {
      p.addEventListener('click', () => {
        pills.forEach(x => x.classList.remove('pill--active'));
        p.classList.add('pill--active');
        render(p.dataset.city);
      });
    });

    // Если пришли ?city=…
    const q = new URLSearchParams(location.search);
    const c = q.get('city');
    if (c) {
      pills.forEach(p => p.classList.toggle('pill--active', p.dataset.city === c));
      render(c);
    } else {
      render('all');
    }
  })();
  </script>

</body>
</html>
