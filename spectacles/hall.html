<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Схема залу — Ваш Адмін</title>
  <link rel="stylesheet" href="/styles.css" />
  <script type="module" src="/scripts/include.js"></script>

  <style>
    .seat.selected { background:#2563eb !important; color:#fff !important; }
  </style>
</head>
<body>
<div id="site-header"></div>

<main class="container" style="display:flex; gap:32px; padding-top:20px;">
  <div style="flex:1;">
    <h1>Схема залу</h1>
    <div id="hall"></div>
  </div>

  <aside style="width:340px;">
    <h2>Ваше замовлення</h2>
    <p id="summary-show"></p>
    <p id="summary-seats"></p>
    <p id="summary-amount"></p>

    <button id="go-order" class="btn btn-primary" disabled>
      Перейти до оформлення
    </button>
    <p class="muted">Кнопка стане активною, коли оберете хоча б одне місце.</p>
  </aside>
</main>

<div id="site-footer"></div>

<script>
// ---------------- ПАРАМЕТРЫ ----------------
const params = new URLSearchParams(location.search);
const show = params.get("show") || "show";
const title = params.get("title") || "";

// ---------------- Данные демо-зала ----------------
const rows = 10;
const seatsPerRow = 12;
const pricePerSeat = 180;

const hallBox = document.getElementById("hall");
const selected = [];

document.getElementById("summary-show").textContent =
  "Вистава: " + (title || show);

// ---------------- Рендер зала ----------------
let html = '<div class="hall-grid">';
for (let r = 1; r <= rows; r++) {
  for (let s = 1; s <= seatsPerRow; s++) {
    const id = `${r}_${s}`;
    html += `<div class="seat" data-id="${id}" data-row="${r}" data-seat="${s}">${s}</div>`;
  }
}
html += "</div>";
hallBox.innerHTML = html;

// ---------------- Выбор мест ----------------
hallBox.addEventListener("click", (e) => {
  const el = e.target.closest(".seat");
  if (!el) return;

  const id = el.dataset.id;

  if (selected.includes(id)) {
    selected.splice(selected.indexOf(id), 1);
    el.classList.remove("selected");
  } else {
    selected.push(id);
    el.classList.add("selected");
  }

  updateSummary();
});

// ---------------- Обновление инфо ----------------
function updateSummary() {
  if (selected.length === 0) {
    document.getElementById("summary-seats").textContent = "Обрані місця: —";
    document.getElementById("summary-amount").textContent = "Сума: 0 грн";
    document.getElementById("go-order").disabled = true;
    return;
  }

  const text = selected
    .map(x => {
      const [r, s] = x.split("_");
      return `Ряд ${r}, місце ${s}`;
    })
    .join("; ");

  document.getElementById("summary-seats").textContent =
    "Обрані місця: " + text;

  document.getElementById("summary-amount").textContent =
    "Сума: " + (selected.length * pricePerSeat) + " грн";

  document.getElementById("go-order").disabled = false;
}

// ---------------- Переход ----------------
document.getElementById("go-order").onclick = () => {
  const seats = selected.join(",");
  const amount = selected.length * pricePerSeat;

  location.href =
    `/order.html?show=${encodeURIComponent(show)}&title=${encodeURIComponent(title)}&seats=${seats}&amount=${amount}`;
};
</script>
</body>
</html>
