<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Афіша — Театральні квитки онлайн</title>

  <!-- ВАЖНО: без начального / -->
  <link rel="stylesheet" href="styles.css"/>

  <style>
    .grid {
      display: grid;
      gap: 16px;
      margin-top: 16px;
    }
    @media (min-width: 850px){
      .grid{grid-template-columns:repeat(3,minmax(0,1fr))}
    }
    .card{
      background:#fff;
      border:1px solid #eee;
      border-radius:12px;
      padding:12px;
      display:grid;
      gap:12px;
      box-shadow:0 8px 20px rgba(15,23,42,0.05);
    }
    .poster{
      width:100%;
      height:260px;
      object-fit:cover;
      border-radius:10px;
      background:#eee;
    }
    .filters{
      display:flex;
      gap:10px;
      margin:12px 0 16px;
      flex-wrap:wrap;
    }
    .pill{
      padding:8px 14px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#f3f4f6;
      cursor:pointer;
      font-size:14px;
    }
    .pill:hover{
      background:#e5e7eb;
    }
    /* активна кнопка */
    .pill--active,
    .pill.active{
      background:#2563eb;
      color:#fff;
      border-color:#2563eb;
    }
  </style>
</head>
<body>

  <div id="site-header"></div>
  <!-- ВАЖНО: без начального / -->
  <script type="module" src="scripts/include.js"></script>

  <main class="main">
    <section class="section">
      <div class="container">

        <h1>Афіша</h1>
        <p class="meta">
          Оберіть виставу та забронюйте квитки онлайн за ціною каси театру.
        </p>

        <div class="filters">
          <button class="pill pill--active" data-city="all">Всі міста</button>
          <button class="pill" data-city="Місто">Місто</button>
          <!-- при реальных данных можно добавить Дніпро / Кривий Ріг и т.п. -->
        </div>

        <div id="grid" class="grid"></div>
        <div id="empty" class="meta" style="display:none">
          Подій за вибраним фільтром поки немає.
        </div>

      </div>
    </section>
  </main>

  <div id="site-footer"></div>

  <script>
    (async () => {
      const grid  = document.getElementById('grid');
      const empty = document.getElementById('empty');
      const pills = document.querySelectorAll('.pill');

      // ВАЖНО: относительный путь
      const res = await fetch('data/afisha.json', { cache: 'no-store' });
      const items = res.ok ? await res.json() : [];

      function cardHTML(s){
        const poster = s.poster ? s.poster : 'images/poster-demo.jpg';
        const show   = encodeURIComponent(s.show);
        return `
          <article class="card">
            <img class="poster" src="${poster}" alt="${s.title||''}" onerror="this.style.display='none'">
            <div><strong>${s.title||''}</strong></div>
            <div class="meta">${[s.date,s.time].filter(Boolean).join(' • ')}</div>
            <div class="meta">${[s.theatre,s.stage].filter(Boolean).join(' • ')}</div>
            <div class="meta">${s.city||''}</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px">
              <a class="btn btn--secondary" href="show.html?show=${show}">Детальніше</a>
              <a class="btn btn--primary" href="spectacles/hall.html?show=${show}">Вибрати місця</a>
            </div>
          </article>`;
      }

      function render(city = 'all'){
        const data = city === 'all'
          ? items
          : items.filter(x => (x.city || '').toLowerCase() === city.toLowerCase());

        grid.innerHTML = data.map(cardHTML).join('');
        empty.style.display = data.length ? 'none' : 'block';
      }

      pills.forEach(p => {
        p.addEventListener('click', () => {
          pills.forEach(x => x.classList.remove('pill--active','active'));
          p.classList.add('pill--active');
          render(p.dataset.city);
        });
      });

      // если в URL есть ?city=...
      const q = new URLSearchParams(location.search);
      const c = q.get('city');

      if (c){
        pills.forEach(p => {
          const active = p.dataset.city === c;
          p.classList.toggle('pill--active', active);
        });
        render(c);
      } else {
        render('all');
      }
    })();
  </script>
</body>
</html>
